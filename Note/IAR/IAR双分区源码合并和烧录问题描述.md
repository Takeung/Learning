### 问题描述

cm0核A、B分区代码合并维护

### 问题背景

目前A、B分区源码只有一个文件中部分代码存在差别，不利于后期维护开发，所以打算通过宏定义的方式把两个分区的cm0核代码合到一个文件，单从代码实现上是没有问题的。

### 问题讨论

黄远: 看上去没什么问题 你的CURREN_PATITION是在哪里定义和赋值的啊
陈德强: uart.h
陈德强: 因为user_timer.c里也有一些log需要区分AB区，两个c文件都用到了uart.h
黄远: 因为boot是在系统刚初始化的时候调用的
黄远: 你可能不能直接简单赋值变量
黄远: 而是要写到flash里去
黄远: 作为一个标志位
陈德强: 这个要怎么操作
黄远: 这个可以参考切换Flash时修改workflash的那段代码
黄远: 但是由于修改Flash都是整个扇区擦除的，需要注意一下地址
黄远: 涉及到flash的话要改的还挺多的感觉
黄远: 这是必要的吗？如果必要的话，你和张阁提个新需求吧
黄远: 因为Boot是在系统初始化之后就直接启动的，这里可能有一点时序上的问题
黄远: [图片]你试试在这句话之后直接给CURREN_PATITION赋值试试
黄远: UART的初始化是在Myinit里面的，在uart里赋值肯定不行
陈德强: 好的我试一下
黄远: 然后你还要考虑到重启之后CURREN_PATITION的值不会保留的问题
陈德强: 多谢多谢 
黄远: 因为切换分区是会重启的
黄远: 感觉想实现这个你只能在Flash里写入一个标志位
陈德强: 嗯嗯，我之前确实考虑太简单了，你说的有道理



![](https://s2.loli.net/2024/08/05/lMGRDvu6XNcVkZ1.png)

程序没烧录进去

看下workflash地址 0x14000000

![](https://s2.loli.net/2024/08/05/aB2k8tObSiIK3vU.png)

在这里直接输入地址跳转就能看workflash了

![](https://s2.loli.net/2024/08/05/d4CH59vP8qQKBtR.png)

上图显示当前正在A区。